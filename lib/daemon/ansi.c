#define ANSI(p) "\e["+p+"m"
#define ANSI_F(p) sprintf("\e[38;5;"+p+"m")
#define ANSI_B(p) sprintf("\e[48;5;"+p+"m")
#define ESC(p) "\e"+p

protected mapping ansiTerm, unknownTerm;

void create () {
    ansiTerm = ([
        "RESET":            ANSI(0),
        "BOLD":             ANSI(1),
        "ITALIC":           ANSI(3),
        "UNDERLINE":        ANSI(4),
        "INVERSE":          ANSI(7),
        "STRIKE":           ANSI(9),
        "BOLD_OFF":         ANSI(22),
        "ITALIC_OFF":       ANSI(23),
        "UNDERLINE_OFF":    ANSI(24),
        "INVERSE_OFF":      ANSI(27),
        "STRIKE_OFF":       ANSI(29),
        "BLACK":            ANSI(30),
        "RED":              ANSI(31),
        "GREEN":            ANSI(32),
        "ORANGE":           ANSI(33),
        "YELLOW":           ANSI("1;33"),
        "BLUE":             ANSI(34),
        "MAGENTA":          ANSI(35),
        "CYAN":             ANSI(36),
        "WHITE":            ANSI(37),
        "B_BLACK":          ANSI(40),
        "B_RED":            ANSI(41),
        "B_GREEN":          ANSI(42),
        "B_ORANGE":         ANSI(43),
        "B_YELLOW":         ANSI("1;43"),
        "B_BLUE":           ANSI(44),
        "B_MAGENTA":        ANSI(45),
        "B_CYAN":           ANSI(46),
        "B_WHITE":          ANSI(47),

        "C01":              ANSI_F(1),
        "C02":              ANSI_F(2),
        "C03":              ANSI_F(3),
        "C04":              ANSI_F(4),
        "C05":              ANSI_F(5),
        "C06":              ANSI_F(6),
        "C07":              ANSI_F(7),
        "C08":              ANSI_F(8),
        "C09":              ANSI_F(9),
        "C10":              ANSI_F(10),
        "C11":              ANSI_F(11),
        "C12":              ANSI_F(12),
        "C13":              ANSI_F(13),
        "C14":              ANSI_F(14),
        "C15":              ANSI_F(15),
        "C16":              ANSI_F(16),
        "AAA":              ANSI_F(16),
        "AAB":              ANSI_F(17),
        "AAC":              ANSI_F(18),
        "AAD":              ANSI_F(19),
        "AAE":              ANSI_F(20),
        "AAF":              ANSI_F(21),
        "ABA":              ANSI_F(22),
        "ABB":              ANSI_F(23),
        "ABC":              ANSI_F(24),
        "ABD":              ANSI_F(25),
        "ABE":              ANSI_F(26),
        "ABF":              ANSI_F(27),
        "ACA":              ANSI_F(28),
        "ACB":              ANSI_F(29),
        "ACC":              ANSI_F(30),
        "ACD":              ANSI_F(31),
        "ACE":              ANSI_F(32),
        "ACF":              ANSI_F(33),
        "ADA":              ANSI_F(34),
        "ADB":              ANSI_F(35),
        "ADC":              ANSI_F(36),
        "ADD":              ANSI_F(37),
        "ADE":              ANSI_F(38),
        "ADF":              ANSI_F(39),
        "AEA":              ANSI_F(40),
        "AEB":              ANSI_F(41),
        "AEC":              ANSI_F(42),
        "AED":              ANSI_F(43),
        "AEE":              ANSI_F(44),
        "AEF":              ANSI_F(45),
        "AFA":              ANSI_F(46),
        "AFB":              ANSI_F(47),
        "AFC":              ANSI_F(48),
        "AFD":              ANSI_F(49),
        "AFE":              ANSI_F(50),
        "AFF":              ANSI_F(51),
        "BAA":              ANSI_F(52),
        "BAB":              ANSI_F(53),
        "BAC":              ANSI_F(54),
        "BAD":              ANSI_F(55),
        "BAE":              ANSI_F(56),
        "BAF":              ANSI_F(57),
        "BBA":              ANSI_F(58),
        "BBB":              ANSI_F(59),
        "BBC":              ANSI_F(60),
        "BBD":              ANSI_F(61),
        "BBE":              ANSI_F(62),
        "BBF":              ANSI_F(63),
        "BCA":              ANSI_F(64),
        "BCB":              ANSI_F(65),
        "BCC":              ANSI_F(66),
        "BCD":              ANSI_F(67),
        "BCE":              ANSI_F(68),
        "BCF":              ANSI_F(69),
        "BDA":              ANSI_F(70),
        "BDB":              ANSI_F(71),
        "BDC":              ANSI_F(72),
        "BDD":              ANSI_F(73),
        "BDE":              ANSI_F(74),
        "BDF":              ANSI_F(75),
        "BEA":              ANSI_F(76),
        "BEB":              ANSI_F(77),
        "BEC":              ANSI_F(78),
        "BED":              ANSI_F(79),
        "BEE":              ANSI_F(80),
        "BEF":              ANSI_F(81),
        "BFA":              ANSI_F(82),
        "BFB":              ANSI_F(83),
        "BFC":              ANSI_F(84),
        "BFD":              ANSI_F(85),
        "BFE":              ANSI_F(86),
        "BFF":              ANSI_F(87),
        "CAA":              ANSI_F(88),
        "CAB":              ANSI_F(89),
        "CAC":              ANSI_F(90),
        "CAD":              ANSI_F(91),
        "CAE":              ANSI_F(92),
        "CAF":              ANSI_F(93),
        "CBA":              ANSI_F(94),
        "CBB":              ANSI_F(95),
        "CBC":              ANSI_F(96),
        "CBD":              ANSI_F(97),
        "CBE":              ANSI_F(98),
        "CBF":              ANSI_F(99),
        "CCA":              ANSI_F(100),
        "CCB":              ANSI_F(101),
        "CCC":              ANSI_F(102),
        "CCD":              ANSI_F(103),
        "CCE":              ANSI_F(104),
        "CCF":              ANSI_F(105),
        "CDA":              ANSI_F(106),
        "CDB":              ANSI_F(107),
        "CDC":              ANSI_F(108),
        "CDD":              ANSI_F(109),
        "CDE":              ANSI_F(110),
        "CDF":              ANSI_F(111),
        "CEA":              ANSI_F(112),
        "CEB":              ANSI_F(113),
        "CEC":              ANSI_F(114),
        "CED":              ANSI_F(115),
        "CEE":              ANSI_F(116),
        "CEF":              ANSI_F(117),
        "CFA":              ANSI_F(118),
        "CFB":              ANSI_F(119),
        "CFC":              ANSI_F(120),
        "CFD":              ANSI_F(121),
        "CFE":              ANSI_F(122),
        "CFF":              ANSI_F(123),
        "DAA":              ANSI_F(124),
        "DAB":              ANSI_F(125),
        "DAC":              ANSI_F(126),
        "DAD":              ANSI_F(127),
        "DAE":              ANSI_F(128),
        "DAF":              ANSI_F(129),
        "DBA":              ANSI_F(130),
        "DBB":              ANSI_F(131),
        "DBC":              ANSI_F(132),
        "DBD":              ANSI_F(133),
        "DBE":              ANSI_F(134),
        "DBF":              ANSI_F(135),
        "DCA":              ANSI_F(136),
        "DCB":              ANSI_F(137),
        "DCC":              ANSI_F(138),
        "DCD":              ANSI_F(139),
        "DCE":              ANSI_F(140),
        "DCF":              ANSI_F(141),
        "DDA":              ANSI_F(142),
        "DDB":              ANSI_F(143),
        "DDC":              ANSI_F(144),
        "DDD":              ANSI_F(145),
        "DDE":              ANSI_F(146),
        "DDF":              ANSI_F(147),
        "DEA":              ANSI_F(148),
        "DEB":              ANSI_F(149),
        "DEC":              ANSI_F(150),
        "DED":              ANSI_F(151),
        "DEE":              ANSI_F(152),
        "DEF":              ANSI_F(153),
        "DFA":              ANSI_F(154),
        "DFB":              ANSI_F(155),
        "DFC":              ANSI_F(156),
        "DFD":              ANSI_F(157),
        "DFE":              ANSI_F(158),
        "DFF":              ANSI_F(159),
        "EAA":              ANSI_F(160),
        "EAB":              ANSI_F(161),
        "EAC":              ANSI_F(162),
        "EAD":              ANSI_F(163),
        "EAE":              ANSI_F(164),
        "EAF":              ANSI_F(165),
        "EBA":              ANSI_F(166),
        "EBB":              ANSI_F(167),
        "EBC":              ANSI_F(168),
        "EBD":              ANSI_F(169),
        "EBE":              ANSI_F(170),
        "EBF":              ANSI_F(171),
        "ECA":              ANSI_F(172),
        "ECB":              ANSI_F(173),
        "ECC":              ANSI_F(174),
        "ECD":              ANSI_F(175),
        "ECE":              ANSI_F(176),
        "ECF":              ANSI_F(177),
        "EDA":              ANSI_F(178),
        "EDB":              ANSI_F(179),
        "EDC":              ANSI_F(180),
        "EDD":              ANSI_F(181),
        "EDE":              ANSI_F(182),
        "EDF":              ANSI_F(183),
        "EEA":              ANSI_F(184),
        "EEB":              ANSI_F(185),
        "EEC":              ANSI_F(186),
        "EED":              ANSI_F(187),
        "EEE":              ANSI_F(188),
        "EEF":              ANSI_F(189),
        "EFA":              ANSI_F(190),
        "EFB":              ANSI_F(191),
        "EFC":              ANSI_F(192),
        "EFD":              ANSI_F(193),
        "EFE":              ANSI_F(194),
        "EFF":              ANSI_F(195),
        "FAA":              ANSI_F(196),
        "FAB":              ANSI_F(197),
        "FAC":              ANSI_F(198),
        "FAD":              ANSI_F(199),
        "FAE":              ANSI_F(200),
        "FAF":              ANSI_F(201),
        "FBA":              ANSI_F(202),
        "FBB":              ANSI_F(203),
        "FBC":              ANSI_F(204),
        "FBD":              ANSI_F(205),
        "FBE":              ANSI_F(206),
        "FBF":              ANSI_F(207),
        "FCA":              ANSI_F(208),
        "FCB":              ANSI_F(209),
        "FCC":              ANSI_F(210),
        "FCD":              ANSI_F(211),
        "FCE":              ANSI_F(212),
        "FCF":              ANSI_F(213),
        "FDA":              ANSI_F(214),
        "FDB":              ANSI_F(215),
        "FDC":              ANSI_F(216),
        "FDD":              ANSI_F(217),
        "FDE":              ANSI_F(218),
        "FDF":              ANSI_F(219),
        "FEA":              ANSI_F(220),
        "FEB":              ANSI_F(221),
        "FEC":              ANSI_F(222),
        "FED":              ANSI_F(223),
        "FEE":              ANSI_F(224),
        "FEF":              ANSI_F(225),
        "FFA":              ANSI_F(226),
        "FFB":              ANSI_F(227),
        "FFC":              ANSI_F(228),
        "FFD":              ANSI_F(229),
        "FFE":              ANSI_F(230),
        "FFF":              ANSI_F(231),
        "G01":              ANSI_F(232),
        "G02":              ANSI_F(233),
        "G03":              ANSI_F(234),
        "G04":              ANSI_F(235),
        "G05":              ANSI_F(236),
        "G06":              ANSI_F(237),
        "G07":              ANSI_F(238),
        "G08":              ANSI_F(239),
        "G09":              ANSI_F(240),
        "G10":              ANSI_F(241),
        "G11":              ANSI_F(242),
        "G12":              ANSI_F(243),
        "G13":              ANSI_F(244),
        "G14":              ANSI_F(245),
        "G15":              ANSI_F(246),
        "G16":              ANSI_F(247),
        "G17":              ANSI_F(248),
        "G18":              ANSI_F(249),
        "G19":              ANSI_F(250),
        "G20":              ANSI_F(251),
        "G21":              ANSI_F(252),
        "G22":              ANSI_F(253),
        "G23":              ANSI_F(254),
        "G24":              ANSI_F(255),

        "B_C01":              ANSI_B(1),
        "B_C02":              ANSI_B(2),
        "B_C03":              ANSI_B(3),
        "B_C04":              ANSI_B(4),
        "B_C05":              ANSI_B(5),
        "B_C06":              ANSI_B(6),
        "B_C07":              ANSI_B(7),
        "B_C08":              ANSI_B(8),
        "B_C09":              ANSI_B(9),
        "B_C10":              ANSI_B(10),
        "B_C11":              ANSI_B(11),
        "B_C12":              ANSI_B(12),
        "B_C13":              ANSI_B(13),
        "B_C14":              ANSI_B(14),
        "B_C15":              ANSI_B(15),
        "B_C16":              ANSI_B(16),
        "B_AAA":              ANSI_B(16),
        "B_AAB":              ANSI_B(17),
        "B_AAC":              ANSI_B(18),
        "B_AAD":              ANSI_B(19),
        "B_AAE":              ANSI_B(20),
        "B_AAF":              ANSI_B(21),
        "B_ABA":              ANSI_B(22),
        "B_ABB":              ANSI_B(23),
        "B_ABC":              ANSI_B(24),
        "B_ABD":              ANSI_B(25),
        "B_ABE":              ANSI_B(26),
        "B_ABF":              ANSI_B(27),
        "B_ACA":              ANSI_B(28),
        "B_ACB":              ANSI_B(29),
        "B_ACC":              ANSI_B(30),
        "B_ACD":              ANSI_B(31),
        "B_ACE":              ANSI_B(32),
        "B_ACF":              ANSI_B(33),
        "B_ADA":              ANSI_B(34),
        "B_ADB":              ANSI_B(35),
        "B_ADC":              ANSI_B(36),
        "B_ADD":              ANSI_B(37),
        "B_ADE":              ANSI_B(38),
        "B_ADF":              ANSI_B(39),
        "B_AEA":              ANSI_B(40),
        "B_AEB":              ANSI_B(41),
        "B_AEC":              ANSI_B(42),
        "B_AED":              ANSI_B(43),
        "B_AEE":              ANSI_B(44),
        "B_AEF":              ANSI_B(45),
        "B_AFA":              ANSI_B(46),
        "B_AFB":              ANSI_B(47),
        "B_AFC":              ANSI_B(48),
        "B_AFD":              ANSI_B(49),
        "B_AFE":              ANSI_B(50),
        "B_AFF":              ANSI_B(51),
        "B_BAA":              ANSI_B(52),
        "B_BAB":              ANSI_B(53),
        "B_BAC":              ANSI_B(54),
        "B_BAD":              ANSI_B(55),
        "B_BAE":              ANSI_B(56),
        "B_BAF":              ANSI_B(57),
        "B_BBA":              ANSI_B(58),
        "B_BBB":              ANSI_B(59),
        "B_BBC":              ANSI_B(60),
        "B_BBD":              ANSI_B(61),
        "B_BBE":              ANSI_B(62),
        "B_BBF":              ANSI_B(63),
        "B_BCA":              ANSI_B(64),
        "B_BCB":              ANSI_B(65),
        "B_BCC":              ANSI_B(66),
        "B_BCD":              ANSI_B(67),
        "B_BCE":              ANSI_B(68),
        "B_BCF":              ANSI_B(69),
        "B_BDA":              ANSI_B(70),
        "B_BDB":              ANSI_B(71),
        "B_BDC":              ANSI_B(72),
        "B_BDD":              ANSI_B(73),
        "B_BDE":              ANSI_B(74),
        "B_BDF":              ANSI_B(75),
        "B_BEA":              ANSI_B(76),
        "B_BEB":              ANSI_B(77),
        "B_BEC":              ANSI_B(78),
        "B_BED":              ANSI_B(79),
        "B_BEE":              ANSI_B(80),
        "B_BEF":              ANSI_B(81),
        "B_BFA":              ANSI_B(82),
        "B_BFB":              ANSI_B(83),
        "B_BFC":              ANSI_B(84),
        "B_BFD":              ANSI_B(85),
        "B_BFE":              ANSI_B(86),
        "B_BFF":              ANSI_B(87),
        "B_CAA":              ANSI_B(88),
        "B_CAB":              ANSI_B(89),
        "B_CAC":              ANSI_B(90),
        "B_CAD":              ANSI_B(91),
        "B_CAE":              ANSI_B(92),
        "B_CAF":              ANSI_B(93),
        "B_CBA":              ANSI_B(94),
        "B_CBB":              ANSI_B(95),
        "B_CBC":              ANSI_B(96),
        "B_CBD":              ANSI_B(97),
        "B_CBE":              ANSI_B(98),
        "B_CBF":              ANSI_B(99),
        "B_CCA":              ANSI_B(100),
        "B_CCB":              ANSI_B(101),
        "B_CCC":              ANSI_B(102),
        "B_CCD":              ANSI_B(103),
        "B_CCE":              ANSI_B(104),
        "B_CCF":              ANSI_B(105),
        "B_CDA":              ANSI_B(106),
        "B_CDB":              ANSI_B(107),
        "B_CDC":              ANSI_B(108),
        "B_CDD":              ANSI_B(109),
        "B_CDE":              ANSI_B(110),
        "B_CDF":              ANSI_B(111),
        "B_CEA":              ANSI_B(112),
        "B_CEB":              ANSI_B(113),
        "B_CEC":              ANSI_B(114),
        "B_CED":              ANSI_B(115),
        "B_CEE":              ANSI_B(116),
        "B_CEF":              ANSI_B(117),
        "B_CFA":              ANSI_B(118),
        "B_CFB":              ANSI_B(119),
        "B_CFC":              ANSI_B(120),
        "B_CFD":              ANSI_B(121),
        "B_CFE":              ANSI_B(122),
        "B_CFF":              ANSI_B(123),
        "B_DAA":              ANSI_B(124),
        "B_DAB":              ANSI_B(125),
        "B_DAC":              ANSI_B(126),
        "B_DAD":              ANSI_B(127),
        "B_DAE":              ANSI_B(128),
        "B_DAF":              ANSI_B(129),
        "B_DBA":              ANSI_B(130),
        "B_DBB":              ANSI_B(131),
        "B_DBC":              ANSI_B(132),
        "B_DBD":              ANSI_B(133),
        "B_DBE":              ANSI_B(134),
        "B_DBF":              ANSI_B(135),
        "B_DCA":              ANSI_B(136),
        "B_DCB":              ANSI_B(137),
        "B_DCC":              ANSI_B(138),
        "B_DCD":              ANSI_B(139),
        "B_DCE":              ANSI_B(140),
        "B_DCF":              ANSI_B(141),
        "B_DDA":              ANSI_B(142),
        "B_DDB":              ANSI_B(143),
        "B_DDC":              ANSI_B(144),
        "B_DDD":              ANSI_B(145),
        "B_DDE":              ANSI_B(146),
        "B_DDF":              ANSI_B(147),
        "B_DEA":              ANSI_B(148),
        "B_DEB":              ANSI_B(149),
        "B_DEC":              ANSI_B(150),
        "B_DED":              ANSI_B(151),
        "B_DEE":              ANSI_B(152),
        "B_DEF":              ANSI_B(153),
        "B_DFA":              ANSI_B(154),
        "B_DFB":              ANSI_B(155),
        "B_DFC":              ANSI_B(156),
        "B_DFD":              ANSI_B(157),
        "B_DFE":              ANSI_B(158),
        "B_DFF":              ANSI_B(159),
        "B_EAA":              ANSI_B(160),
        "B_EAB":              ANSI_B(161),
        "B_EAC":              ANSI_B(162),
        "B_EAD":              ANSI_B(163),
        "B_EAE":              ANSI_B(164),
        "B_EAF":              ANSI_B(165),
        "B_EBA":              ANSI_B(166),
        "B_EBB":              ANSI_B(167),
        "B_EBC":              ANSI_B(168),
        "B_EBD":              ANSI_B(169),
        "B_EBE":              ANSI_B(170),
        "B_EBF":              ANSI_B(171),
        "B_ECA":              ANSI_B(172),
        "B_ECB":              ANSI_B(173),
        "B_ECC":              ANSI_B(174),
        "B_ECD":              ANSI_B(175),
        "B_ECE":              ANSI_B(176),
        "B_ECF":              ANSI_B(177),
        "B_EDA":              ANSI_B(178),
        "B_EDB":              ANSI_B(179),
        "B_EDC":              ANSI_B(180),
        "B_EDD":              ANSI_B(181),
        "B_EDE":              ANSI_B(182),
        "B_EDF":              ANSI_B(183),
        "B_EEA":              ANSI_B(184),
        "B_EEB":              ANSI_B(185),
        "B_EEC":              ANSI_B(186),
        "B_EED":              ANSI_B(187),
        "B_EEE":              ANSI_B(188),
        "B_EEF":              ANSI_B(189),
        "B_EFA":              ANSI_B(190),
        "B_EFB":              ANSI_B(191),
        "B_EFC":              ANSI_B(192),
        "B_EFD":              ANSI_B(193),
        "B_EFE":              ANSI_B(194),
        "B_EFF":              ANSI_B(195),
        "B_FAA":              ANSI_B(196),
        "B_FAB":              ANSI_B(197),
        "B_FAC":              ANSI_B(198),
        "B_FAD":              ANSI_B(199),
        "B_FAE":              ANSI_B(200),
        "B_FAF":              ANSI_B(201),
        "B_FBA":              ANSI_B(202),
        "B_FBB":              ANSI_B(203),
        "B_FBC":              ANSI_B(204),
        "B_FBD":              ANSI_B(205),
        "B_FBE":              ANSI_B(206),
        "B_FBF":              ANSI_B(207),
        "B_FCA":              ANSI_B(208),
        "B_FCB":              ANSI_B(209),
        "B_FCC":              ANSI_B(210),
        "B_FCD":              ANSI_B(211),
        "B_FCE":              ANSI_B(212),
        "B_FCF":              ANSI_B(213),
        "B_FDA":              ANSI_B(214),
        "B_FDB":              ANSI_B(215),
        "B_FDC":              ANSI_B(216),
        "B_FDD":              ANSI_B(217),
        "B_FDE":              ANSI_B(218),
        "B_FDF":              ANSI_B(219),
        "B_FEA":              ANSI_B(220),
        "B_FEB":              ANSI_B(221),
        "B_FEC":              ANSI_B(222),
        "B_FED":              ANSI_B(223),
        "B_FEE":              ANSI_B(224),
        "B_FEF":              ANSI_B(225),
        "B_FFA":              ANSI_B(226),
        "B_FFB":              ANSI_B(227),
        "B_FFC":              ANSI_B(228),
        "B_FFD":              ANSI_B(229),
        "B_FFE":              ANSI_B(230),
        "B_FFF":              ANSI_B(231),
        "B_G01":              ANSI_B(232),
        "B_G02":              ANSI_B(233),
        "B_G03":              ANSI_B(234),
        "B_G04":              ANSI_B(235),
        "B_G05":              ANSI_B(236),
        "B_G06":              ANSI_B(237),
        "B_G07":              ANSI_B(238),
        "B_G08":              ANSI_B(239),
        "B_G09":              ANSI_B(240),
        "B_G10":              ANSI_B(241),
        "B_G11":              ANSI_B(242),
        "B_G12":              ANSI_B(243),
        "B_G13":              ANSI_B(244),
        "B_G14":              ANSI_B(245),
        "B_G15":              ANSI_B(246),
        "B_G16":              ANSI_B(247),
        "B_G17":              ANSI_B(248),
        "B_G18":              ANSI_B(249),
        "B_G19":              ANSI_B(250),
        "B_G20":              ANSI_B(251),
        "B_G21":              ANSI_B(252),
        "B_G22":              ANSI_B(253),
        "B_G23":              ANSI_B(254),
        "B_G24":              ANSI_B(255),
    ]);
    unknownTerm = map(ansiTerm, function () { return ""; });
}

string *query_keys () { return keys(unknownTerm); }

mapping query_ansi_term () { return ansiTerm; }
mapping query_unknown_term () { return unknownTerm; }
string parse (string str) {
    return terminal_colour(str, ansiTerm);
}